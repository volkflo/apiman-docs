<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How To: Elasticsearch :: Apiman Documentation</title>
    <link rel="canonical" href="https://volkflo.github.io/apiman-docs/installation-guide/latest/how-to/elasticsearch.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-56678850-3"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-56678850-3')</script>
    <script>var uiRootPath = '../../../_'</script>
<link rel="icon" href="../../../_/img/apiman/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div id="apiman-logo"></div>
    <div class="navbar-brand">
      <a class="navbar-item" href="https://volkflo.github.io/apiman-docs">Apiman Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.apiman.io/latest/index.html">Home</a>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.apiman.io/latest/download.html">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="installation-guide" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Apiman Installation Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../index.html">Introduction</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../quickstart.html">Quickstart</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Gateway</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Vertx</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../vertx/download.html">Vert.x Gateway</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../vertx/download.html#_download_launch">Download &amp; Launch</a>
  </li>
  <li class="nav-item" data-depth="4">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../vertx/download.html#_configurations">Configurations</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../vertx/download.html#_elasticsearch">Elasticsearch</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../vertx/download.html#_headless_elasticsearch">Headless ES</a>
  </li>
  <li class="nav-item" data-depth="5">
    <a class="nav-link" href="../vertx/download.html#_3scale_immutable">3scale Immutable</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../vertx/install.html">Installation Walkthrough</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../vertx/config-guide.html">Config Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Servlet</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../servlet/install.html">EAP &amp; WildFly</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../servlet/install.html#_installing_in_wildfly_10">WildFly 10</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../servlet/install.html#_installing_in_wildfly_9">WildFly 9</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../servlet/install.html#_installing_in_jboss_eap_7">EAP 7</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../servlet/install.html#_installing_using_docker">Docker</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../servlet/config-guide.html">Config Guide</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Registries and Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../registries-and-components/overview.html">Registries &amp; Components</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../registries-and-components/jdbc.html">JDBC</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../registries-and-components/elasticsearch.html">Elasticsearch</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../registries-and-components/headless.html">Headless</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../registries-and-components/3scale_immutable.html">3scale Immutable</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../gateway/security.html">Security</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../gateway/security.html#_gateway_api_authentication">Gateway API Authentication</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../gateway/security.html#_mtls_mutual_ssl_endpoint_security">Mutual TLS (MTLS/MSSL)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Manager</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../manager/configuration.html">General Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/configuration.html#_logging_in">Logging In</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/configuration.html#_custom_api_catalog">Custom API Catalog</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/configuration.html#_custom_plugin_registry">Custom Plugin Registry</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/configuration.html#_property_replacement_in_policy_config">Policy Config Property Replacement</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manager/backup-migration.html#_backup_migration">Backup &amp; Migration</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manager/backup-migration.html#_upgrading_to_a_new_apiman_version">Upgrading Apiman</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">How to</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_use_elasticsearch_instead_of_an_rdbms">Elasticsearch Instead of RDBMS</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#_use_standalone_elasticsearch_instance_cluster">Standalone Elasticsearch Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="security.html#_external_keycloak_authentication">External Keycloak Authentication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="jdbc.html">SQL Metrics Instead of Elasticsearch</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../production.html">Production Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Gateway</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../gateway/production-gateway.html">Vertx</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../gateway/production-gateway-wildfly.html">Wildfly</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manager/production-manager.html">Manager</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apiman Installation Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../core/latest/development/Guide.html">Apiman Development Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../core/latest/development/Guide.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Apiman Installation Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../user-guide/latest/index.html">Apiman User Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../user-guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../welcome/latest/index.html">Apiman Welcome</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../welcome/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../welcome/latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Apiman Installation Guide</a></li>
    <li>How to</li>
    <li><a href="#_use_elasticsearch_instead_of_an_rdbms">Elasticsearch Instead of RDBMS</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apiman/apiman-docs-installation-guide/edit/antora-updated/modules/ROOT/pages/how-to/elasticsearch.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">How To: Elasticsearch</h1>
<div class="sect1">
<h2 id="_use_elasticsearch_instead_of_an_rdbms"><a class="anchor" href="#_use_elasticsearch_instead_of_an_rdbms"></a>Use Elasticsearch instead of an RDBMS</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The API Manager is configured (by default) to use JPA as the persistence technology for storing all of its data.  But this isn&#8217;t the only persistence technology supported.
Another option is to use Elasticsearch.
This section details how to set up apiman to use Elasticsearch instead of an RDBMS to store your API Manager data.</p>
</div>
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and install <a href="https://www.elastic.co/downloads/elasticsearch">Elasticsearch</a></p>
</li>
<li>
<p>Make changes to <code>apiman.properties</code> to switch from JPA to Elasticsearch</p>
</li>
<li>
<p>(Re)start apiman!</p>
</li>
<li>
<p>Perform standard admin configuration of apiman (the database will of course be empty!)</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_download_and_install_elasticsearch"><a class="anchor" href="#_download_and_install_elasticsearch"></a>Download and install Elasticsearch</h3>
<div class="paragraph">
<p>This part is pretty easy - download the Elasticsearch software and get it running.
A very good resource for this can be found here:</p>
</div>
<div class="paragraph">
<p><a href="http://www.elastic.co/guide/en/elasticsearch/guide/master/getting-started.html" class="bare">http://www.elastic.co/guide/en/elasticsearch/guide/master/getting-started.html</a></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
As of apiman 1.1.4.Final, an instance of Elasticsearch is included in the default apiman distribution.
You may use it as your API Manager persistence store.
It is running on port 19200.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_make_changes_to_apiman_properties"><a class="anchor" href="#_make_changes_to_apiman_properties"></a>Make changes to <code>apiman.properties</code></h3>
<div class="paragraph">
<p>Once Elasticsearch is running smoothly, you must make some changes to the <strong><code>apiman.properties</code></strong> file in order to tell apiman to use ES instead of a database.
You should modify the <code>apiman.properties</code> file to have the following properties set:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can optionally also set the username and password - this is only useful if you are using something like Elasticsearch Shield to enable basic authentication.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiman.es.protocol=http
apiman.es.host=localhost
apiman.es.port=19200
apiman.es.username=
apiman.es.password=

apiman-manager.storage.type=es
apiman-manager.storage.es.protocol=${apiman.es.protocol}
apiman-manager.storage.es.host=${apiman.es.host}
apiman-manager.storage.es.port=${apiman.es.port}
apiman-manager.storage.es.username=${apiman.es.username}
apiman-manager.storage.es.password=${apiman.es.password}
apiman-manager.storage.es.initialize=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure you enter appropriate values for the <code>apiman.es.protocol</code>, <code>apiman.es.host</code>, and <code>apiman.es.port</code> properties.
These values should reflect the settings of your Elasticsearch instance.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are using a standalone gateway instance you will need to configure it separately to point to the same datastore. For example, <code>conf.json</code> for Vert.x and <code>standalone.xml</code> for Servlet.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_restart_apiman"><a class="anchor" href="#_restart_apiman"></a>(Re)start apiman</h3>
<div class="paragraph">
<p>If apiman was running, you should stop it now.
Once everything is shutdown, and the changes to <code>apiman.properties</code> have been made, go ahead and start apiman up again.
It will pick up the new settings in <code>apiman.properties</code> and attempt to use Elasticsearch instead of the database!</p>
</div>
<div class="paragraph">
<div class="title">Perform standard admin configuration</div>
<p>Note that the apiman quickstart overlay ZIP comes pre-configured with a number of settings, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Installed policy definitions</p>
</li>
<li>
<p>Default configured roles (Organization Owner, API Developer, Application Developer)</p>
</li>
<li>
<p>A default configured Gateway</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This built-in configuration will be lost when you switch from JPA to Elasticsearch.
You will need to use the apiman admin UI to reconfigure these settings.
Refer to the "System Administration" section of the User Guide for more information on this.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_use_standalone_elasticsearch_instancecluster"><a class="anchor" href="#_use_standalone_elasticsearch_instancecluster"></a>Use standalone Elasticsearch instance/cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The apiman quickstart overlay ZIP ships by default with an embedded instance of Elasticsearch.
This is suitable for getting up and running quickly, but is not a good long term solution.
Instead, users are encouraged to install a standalone instance of Elasticsearch and point apiman to it.</p>
</div>
<div class="sect2">
<h3 id="_high_level_overview"><a class="anchor" href="#_high_level_overview"></a>High Level Overview</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and install <a href="https://www.elastic.co/downloads/elasticsearch">Elasticsearch</a></p>
</li>
<li>
<p>Make changes to "apiman.properties" to point to your standalone Elasticsearch instance</p>
</li>
<li>
<p>(Re)start apiman!</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_download_and_install_elasticsearch_2"><a class="anchor" href="#_download_and_install_elasticsearch_2"></a>Download and install Elasticsearch</h3>
<div class="paragraph">
<p>This part is pretty easy - download the Elasticsearch software and get it running.
A very good resource for this can be found here:</p>
</div>
<div class="paragraph">
<p><a href="http://www.elastic.co/guide/en/elasticsearch/guide/master/getting-started.html" class="bare">http://www.elastic.co/guide/en/elasticsearch/guide/master/getting-started.html</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_make_changes_to_apiman_properties_2"><a class="anchor" href="#_make_changes_to_apiman_properties_2"></a>Make changes to "apiman.properties"</h3>
<div class="paragraph">
<p>Once Elasticsearch is running smoothly, you must make some minor changes to the <strong>apiman.properties</strong> file in order to tell apiman where your Elasticsearch instance is located.</p>
</div>
<div class="paragraph">
<p>There are a set of global properties used for all apiman components that use Elasticsearch to load data.
These properties are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">apiman.es.protocol=http
apiman.es.host=localhost
apiman.es.port=19200
apiman.es.username=
apiman.es.password=</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make sure you enter appropriate values for this properties - they should reflect the settings of your Elasticsearch installation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restart_apiman_2"><a class="anchor" href="#_restart_apiman_2"></a>(Re)start apiman</h3>
<div class="paragraph">
<p>If apiman was running, you should stop it now.
Once everything is shutdown, and the changes to <code>apiman.properties</code> have been made, go ahead and start apiman up again.
It will pick up the new settings in <code>apiman.properties</code> and attempt to use Elasticsearch instead of Infinispan.</p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
