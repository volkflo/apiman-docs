<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Apiman Policies :: Apiman Documentation</title>
    <link rel="canonical" href="https://volkflo.github.io/apiman-docs/user-guide/latest/gateway/policies.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-56678850-3"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-56678850-3')</script>
    <script>var uiRootPath = '../../../_'</script>
<link rel="icon" href="../../../_/img/apiman/favicon.ico" type="image/x-icon">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div id="apiman-logo"></div>
    <div class="navbar-brand">
      <a class="navbar-item" href="https://volkflo.github.io/apiman-docs">Apiman Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://www.apiman.io/latest/index.html">Home</a>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://www.apiman.io/latest/download.html">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="user-guide" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Apiman User Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../crash-course/Guide.html">Crash Course</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Gateway</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="concepts.html">Concepts</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="policies.html">Policy Types</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="policies.html">Policies</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_authorization_policy">Authorization</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_basic_authentication_policy">BASIC Auth</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_caching_policy_depracted">Caching Policy (Deprecated)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_caching_resources_policy">Caching Resources Policy</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_cors_policy">CORS</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_header-allow-deny-policy">Header Allow/Deny</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_http_security_policy">HTTP Security</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_ignored_resources_policy">Ignored Resources</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_ip_blacklist_policy">IP Blacklist</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_ip_whitelist_policy">IP Whitelist</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_jsonp_policy">JSONP</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_jwt_policy">JWT</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_keycloak_oauth_policy">Keycloak OAuth</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_log_policy">Log Policy</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_quota_policy">Quota</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_rate_limiting_policy">Rate Limiting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_simple_header_policy">Simple Header</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_soap_authorization_policy">SOAP Authorization</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_time_restricted_access_policy">Time Restricted Access</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_transfer_quota_policy">Transfer Quota</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_transformation_policy">Transformation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_url_rewriting_policy">URL Rewriting</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#_url_whitelist_policy">URL Whitelist</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Manager</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../manager/concepts.html">Concepts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/concepts.html#_data_model">Data Model</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/concepts.html#_policy_chain">Policy Chain</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/concepts.html#_user_management">User Management</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/concepts.html#_managing_organizations">Managing Organizations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/concepts.html#_managing_plans">Managing Plans</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/concepts.html#_providing_apis">Providing APIs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/concepts.html#_consuming_apis">Consuming APIs</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../manager/concepts.html#_versioning">Versioning</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../manager/administration.html">Administration</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Apiman User Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../core/latest/development/Guide.html">Apiman Development Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../core/latest/development/Guide.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../installation-guide/latest/index.html">Apiman Installation Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../installation-guide/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Apiman User Guide</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../welcome/latest/index.html">Apiman Welcome</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../welcome/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../welcome/latest/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Apiman User Guide</a></li>
    <li>Gateway</li>
    <li><a href="policies.html">Policy Types</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apiman/apiman-docs-user-guide/edit/antora-updated/modules/ROOT/pages/gateway/policies.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Apiman Policies</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The most important runtime concept in apiman is the policy.
Policies are configured in the API Manager and then applied at runtime by the API Gateway.
This section of the guide provides more information about each of the policies available in apiman, what they do, and how they can be configured.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_policy_types"><a class="anchor" href="#_policy_types"></a>Policy Types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apiman supports several policy types like security, limiting, modification and others which are explained in the following.</p>
</div>
<div class="sect2">
<h3 id="_security_policies"><a class="anchor" href="#_security_policies"></a>Security Policies</h3>
<div class="paragraph">
<p>There are authentication-based policies which manage access to an API is governed by the identity of the user.
And there are authorization-based policies which manage access to an API, or specific resources provided by an API, is governed by the role(s) assigned to a user.</p>
</div>
<div class="paragraph">
<p>Apiman supports these types of security policies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authorization Policy</p>
</li>
<li>
<p>BASIC Authentication Policy</p>
</li>
<li>
<p>CORS Policy</p>
</li>
<li>
<p>Header Allow/Deny Policy</p>
</li>
<li>
<p>HTTP Security Policy</p>
</li>
<li>
<p>Ignored Resources Policy</p>
</li>
<li>
<p>IP Blacklist Policy</p>
</li>
<li>
<p>IP Whitelist Policy</p>
</li>
<li>
<p>JWT Policy</p>
</li>
<li>
<p>Keycloak OAuth Policy</p>
</li>
<li>
<p>SOAP Authorization Policy</p>
</li>
<li>
<p>Time Restricted Access Policy</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_limiting_policies"><a class="anchor" href="#_limiting_policies"></a>Limiting Policies</h3>
<div class="paragraph">
<p>Some apiman policies provide an all-or-nothing level of control over access to managed APIs.
For example, IP Blacklist or Whitelist policies either block or enable all access to a managed API, based on the IP address of the client.
Rate limiting and quota policies provide you with more flexible ways to govern access to managed APIs.
With rate limiting and quota policies, you can place limits on either the number of requests an API will accept over a specified period of time, or the total number of of bytes in the API requests.
In addition, you can use combinations of fine-grained and coarse-grained rate limiting policies together to give you more flexibility in governing access to your managed API.</p>
</div>
<div class="paragraph">
<p>The ability to throttle API requests based on request counts and bytes transferred provides even greater flexibility in implementing policies.
APIs that transfer larger amounts of data, but rely on fewer API requests can have that data transfer throttled on a per byte basis.
For example, an API that is data intensive, will return a large amount of data in response to each API request.
The API may only receive a request a few hundreds of times a day, but each request may result in several megabytes of data being transferred.
Let&#8217;s say that we want to limit the amount of data transferred to 6GB per hour. For this type of API, we could set a rate limiting policy to allow for one request per minute, and then augment that policy with a transfer quota policy of 100Mb per hour.</p>
</div>
<div class="paragraph">
<p>Each of these policies, if used singly, can be effective in throttling requests.
apiman, however, adds an additional layer of flexibility to your use of these policy types by enabling you to use them in combinations.</p>
</div>
<div class="paragraph">
<p>apiman supports these types of limiting policies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Quota Policy</p>
</li>
<li>
<p>Rate Limiting Policy</p>
</li>
<li>
<p>Transfer Quota Policy</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_modification_policies"><a class="anchor" href="#_modification_policies"></a>Modification Policies</h3>
<div class="paragraph">
<p>Apiman supports these types of modification policies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JSONP Policy</p>
</li>
<li>
<p>Simple Header Policy</p>
</li>
<li>
<p>URL Rewriting Policy</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_other_policies"><a class="anchor" href="#_other_policies"></a>Other Policies</h3>
<div class="paragraph">
<p>Apiman supports these types of other policies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>APIKey Policy</p>
</li>
<li>
<p>Caching Resource Policy</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_policies"><a class="anchor" href="#_policies"></a>Policies</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_authorization_policy"><a class="anchor" href="#_authorization_policy"></a>Authorization Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-authorization"><a class="anchor" href="#policy-authorization"></a>Description</h3>
<div class="paragraph">
<p>This policy enables fine grained authorization to API resources based on authenticated user roles.
This policy can be used to control precisely who (authenticated users) are allowed to access the API, at an arbitrarily fine-grained level.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration of this policy consists of a number of rules that are applied to any inbound request to the API.
Each rule consists of a regular expression pattern, an HTTP verb, and the role that an authenticated user must possess in order for access to be granted.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It&#8217;s <strong>very</strong> important to note that this policy must be configured <strong>after</strong> one of the standard apiman authentication policies (e.g. the BASIC Authentication policy or the Keycloak OAuth Policy).
The reason is that an Authentication policy is responsible for extracting the authenticated user&#8217;s roles, which is data that is required for the Authorization Policy to do its work.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>rules</strong> (array) : Array of rules - each rule is applied only if it matches the current request.</p>
<div class="ulist">
<ul>
<li>
<p><strong>pathPattern</strong> (string regexp) : Pattern that must match the request resource path you&#8217;d like the policy to be applicable to.</p>
</li>
<li>
<p><strong>verb</strong> (string) : The HTTP verb that must match the request you&#8217;d like the policy to be applicable to.</p>
</li>
<li>
<p><strong>role</strong> (string) : The role the user must have if this pattern matches the request.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>multimatch</strong> (boolean) : Should the request pass when any or all of the authorization rules pass?  Set to true if all rules must match, false if only one rule must match.</p>
</li>
<li>
<p><strong>requestUnmatched</strong> (boolean) : If the request does not match any of the authorization rules, should it pass or fail?  Set to true if you want the policy to <strong>pass</strong> when no rules are matched.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration"><a class="anchor" href="#_sample_configuration"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "rules" : [
   	{
   		"pathPattern": "/admin/.*",
   		"verb": "*",
   		"role": "admin"
   	},
   	{
   		"pathPattern": "/.*",
   		"verb": "GET",
   		"role": "user"
   	}
   ],
   "multiMatch": true,
   "requestUnmatched": false
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_basic_authentication_policy"><a class="anchor" href="#_basic_authentication_policy"></a>BASIC Authentication Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-basic-auth"><a class="anchor" href="#policy-basic-auth"></a>Description</h3>
<div class="paragraph">
<p>This policy enables HTTP BASIC Authentication on an API.
In other words, you can use this policy to require clients to provide HTTP BASIC authentication credentials when making requests to the managed API.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>Configuration</h3>
<div class="paragraph">
<p>The BASIC Authentication policy has a number of configuration options.
There are several top level configuration properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>realm</strong> (string) : defines the BASIC Auth realm that will be used when responding with an auth challenge (when authentication is missing or fails)</p>
</li>
<li>
<p><strong>forwardIdentityHttpHeader</strong> (string) : if authentication succeeds, indicates the name of an HTTP header to send with the principal/identity of the authenticated user (useful when the back-end API needs to know the identify of the authenticated user)</p>
</li>
<li>
<p><strong>requireTransportSecurity</strong> (boolean) : set to true if this policy should fail when receiving a message over an unsecured communication channel (in other words, enabling this will require clients to use <strong>https</strong>)</p>
</li>
<li>
<p><strong>requireBasicAuth</strong> (boolean) : set to true if BASIC authentication credentials are <strong>required</strong> (set to false if alternative authentication mechanisms, such as OAuth, are also supported)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, one of the following complex properties must be included in the configuration, indicating whether apiman should use JDBC, LDAP, or Static (not recommended for production) information as the source of identity used to validate provided user credentials.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jdbcIdentity</strong> (object) : included when you wish to use JDBC to connect to a database containing user and password information</p>
<div class="ulist">
<ul>
<li>
<p><strong>type</strong> (enum) : what type of JDBC connection to use - options are 'datasource', 'url'</p>
</li>
<li>
<p><strong>datasourcePath</strong> (string) : the JNDI path of the datasource to use (only when type is 'datasource')</p>
</li>
<li>
<p><strong>jdbcUrl</strong> (string) : the URL to the JDBC database (only when type is 'url')</p>
</li>
<li>
<p><strong>username</strong> (string) : the Username to use when connecting to the JDBC database (only when type is 'url')</p>
</li>
<li>
<p><strong>password</strong> (string) : the Passowrd to use when connecting to the JDBC database (only when type is 'url')</p>
</li>
<li>
<p><strong>query</strong> (string) : the SQL query to use when searching for a user record - the first parameter passed to the query will be the username, the second parameter will be the (optionally hashed) password</p>
</li>
<li>
<p><strong>hashAlgorithm</strong> (enum) : the hashing algorithm used when storing the password data in the database</p>
</li>
<li>
<p><strong>extractRoles</strong> (boolean) : set to true if you also want to extract role information from the database</p>
</li>
<li>
<p><strong>roleQuery</strong> (string) : a SQL query to use when extracting role information - the first parameter passed to the query will be the username</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>ldapIdentity</strong> (object) : included when you wish to connect to LDAP when validating user credentials</p>
<div class="ulist">
<ul>
<li>
<p><strong>url</strong> (string) : the URL to the LDAP server</p>
</li>
<li>
<p><strong>dnPattern</strong> (string) : the pattern to use when binding to the LDAP server (you can use ${username} in this pattern)</p>
</li>
<li>
<p><strong>bindAs</strong> (enum) : whether to bind directly to LDAP as the authenticating user (UserAccount), or instead to bind as a service account and then search LDAP for the user&#8217;s record (ServiceAccount)</p>
</li>
<li>
<p><strong>credentials</strong> (object) : an object with two properties: 'username' and 'password' - credentials used when initially binding to LDAP as a service account</p>
</li>
<li>
<p><strong>userSearch</strong> (object) : an object with two properties: 'baseDn' and 'expression' - used to search for the user&#8217;s LDAP record so that it can be used to re-bind to LDAP with the appropriate password</p>
</li>
<li>
<p><strong>extractRoles</strong> (boolean) : set to true if you wish to extract role information from LDAP</p>
</li>
<li>
<p><strong>membershipAttribute</strong> (string) : the attribute representing the user&#8217;s membership in a group - each value should be a reference to another LDAP node</p>
</li>
<li>
<p><strong>rolenameAttribute</strong> (string) : the attribute on a role LDAP node that represents the name of the role</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>staticIdentity</strong> (object) : used mostly for testing purposes - allows you to provide a static set of user names and passwords (do not use in production!)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_ldap"><a class="anchor" href="#_sample_configuration_ldap"></a>Sample Configuration (LDAP)</h3>
<div class="paragraph">
<p>Here is an example of the JSON configuration you might use when configuring a BASIC Authentication policy that uses LDAP to validate the inbound credentials:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "realm" : "Example",
   "forwardIdentityHttpHeader" : "X-Identity",
   "requireTransportSecurity" : true,
   "requireBasicAuth" : true,
   "ldapIdentity" : {
      "url" : "ldap://example.org",
      "dnPattern" : "cn=${username},dc=example,dc=org",
      "bindAs" : "UserAccount",
      "extractRoles" : true,
      "membershipAttribute" : "memberOf",
      "rolenameAttribute" : "objectGUID"
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_jdbc"><a class="anchor" href="#_sample_configuration_jdbc"></a>Sample Configuration (JDBC)</h3>
<div class="paragraph">
<p>Here is an example of the JSON configuration you might use when configuring a BASIC Authentication policy that uses JDBC to validate the inbound credentials:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "realm" : "Example",
   "forwardIdentityHttpHeader" : "X-Identity",
   "requireTransportSecurity" : true,
   "requireBasicAuth" : true,
   "jdbcIdentity" : {
      "type" : "url",
      "jdbcUrl" : "jdbc:h2:mem:UserDB",
      "username" : "dbuser",
      "password" : "dbpass123#",
      "query" : "SELECT * FROM users WHERE userid = ? AND pass = ?",
      "hashAlgorithm" : "SHA1",
      "extractRoles" : true,
      "roleQuery" : "SELECT r.rolename FROM roles r WHERE r.user = ?"
   }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_caching_policy_deprecated"><a class="anchor" href="#_caching_policy_deprecated"></a>Caching Policy (Deprecated)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-caching"><a class="anchor" href="#policy-caching"></a>Description</h3>
<div class="paragraph">
<p>This policy is deprecated. Use <a href="#_caching_resources_policy">Caching Resources Policy</a> instead.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_caching_resources_policy"><a class="anchor" href="#_caching_resources_policy"></a>Caching Resources Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-caching-resources"><a class="anchor" href="#policy-caching-resources"></a>Description</h3>
<div class="paragraph">
<p>Allows caching of API responses in the Gateway to reduce overall traffic to the back-end API.
The Resource Caching Policy can cache requests based on their URL path, http method and specific status code.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_3"><a class="anchor" href="#_configuration_3"></a>Configuration</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you want to cache POST requests you have to enable stateful request payload inspection in your API Implementation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration parameters for an Caching Resources Policy are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ttl</strong> (long) : Number of seconds to cache the response.</p>
</li>
<li>
<p><strong>cachingResourcesSettingsEntries</strong> (array of objects) : The list of matching rules representing the resources to be cached.</p>
<div class="ulist">
<ul>
<li>
<p><strong>httpMethod</strong> (enum) : The HTTP method to be controlled by the rule. Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>* (matches all cachable http methods, see  <a href="https://developer.mozilla.org/en-US/docs/Glossary/cacheable" class="bare">https://developer.mozilla.org/en-US/docs/Glossary/cacheable</a>)</p>
</li>
<li>
<p>GET</p>
</li>
<li>
<p>POST (see important note above)</p>
</li>
<li>
<p>HEAD</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>pathPattern</strong> (string regexp) : A regular expression used to match the REST resource being cached.</p>
</li>
<li>
<p><strong>statusCode</strong> (string): Either a single number representing a specific status code or * to cache all status codes.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_2"><a class="anchor" href="#_sample_configuration_2"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "ttl" : 60,
  "cachingResourcesSettingsEntries" : [
    { "httpMethod" : "GET",  "pathPattern" : "/customers", "statusCode" : "200" },
    { "httpMethod" : "POST", "pathPattern" : "/customers/.*/orders", "statusCode": "*" },
    { "httpMethod" : "*",    "pathPattern" : "/customers/.*/orders/bad_debts", "statusCode": "403" }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_cors_policy"><a class="anchor" href="#_cors_policy"></a>CORS Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-cors"><a class="anchor" href="#policy-cors"></a>Description</h3>
<div class="paragraph">
<p>A policy implementing CORS (Cross-origin resource sharing): a method of defining access to resources outside of the originating domain.
It is principally a security mechanism to prevent the loading of resources from unexpected domains, for instance via XSS injection attacks.</p>
</div>
<div class="paragraph">
<p>For further references, see <a href="http://www.w3.org/TR/2014/REC-cors-20140116/">CORS W3C Recommendation 16 January 2014</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS#Access-Control-Allow-Origin">MDN&#8217;s articles</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin"><a class="anchor" href="#_plugin"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "groupId": "io.apiman.plugins",
    "artifactId": "apiman-plugins-cors-policy",
    "version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_4"><a class="anchor" href="#_configuration_4"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration options available, are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. CORS policy configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">errorOnCorsFailure</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Error on CORS failure</strong>
When true, any request that fails CORS validation will be terminated with an appropriate error. When false, the request will still be sent to the backend API, but the browser will be left to enforce the CORS failure. In both cases valid CORS headers will be set.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowOrigin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set&lt;String&gt;</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Access-Control-Allow-Origin</strong>
List of origins permitted to make CORS requests through the gateway. By default same-origin is permitted, and cross-origin is forbidden.
A special entry of <code>*</code> permits all CORS requests.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowCredentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Access-Control-Allow-Credentials</strong>
Whether response may be exposed when the <code>credentials</code> flag is set to true on the request.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exposeHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set&lt;String&gt;</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Access-Control-Expose-Headers</strong>
Which non-simple headers the browser may expose during CORS.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set&lt;String&gt;</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Access-Control-Allow-Headers</strong>
In response to preflight request, which <em>headers</em> can be used during actual request.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowMethods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set&lt;String&gt;</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Access-Control-Allow-Methods</strong>
In response to preflight request, which <em>methods</em> can be used during actual request.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Access-Control-Max-Age</strong>
How long preflight request can be cached in delta seconds.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not included</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_sample_configuration_3"><a class="anchor" href="#_sample_configuration_3"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "exposeHeaders" : [
      "X-REQUESTS-REMAINING"
   ],
   "maxAge" : 9001,
   "allowOrigin" : [
      "https://foo.example",
      "https://bar.example"
   ],
   "errorOnCorsFailure" : true,
   "allowCredentials" : false,
   "allowMethods" : [
      "POST"
   ],
   "allowHeaders" : [
      "X-CUSTOM-HEADER"
   ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_header_allowdeny"><a class="anchor" href="#_header_allowdeny"></a>Header Allow/Deny</h2>
<div class="sectionbody">
<div id="policy-header-allow-deny" class="paragraph">
<p>The <strong>Header Allow/Deny Policy</strong> allows the user to control which incoming
requests may be forwarded to the backend service. Permission is granted
by adding values for a header.</p>
</div>
<div class="paragraph">
<p>When a request is received, the policy examines the HTTP headers. The
configured rules are applied using a regular expression against the
names and values. If these are permitted, the request is passed
unmodified to the backend API. If they are not allowed, an HTTP 403
response is returned and the call to the backend service is not
executed.</p>
</div>
<div class="sect2">
<h3 id="_configuration_5"><a class="anchor" href="#_configuration_5"></a>Configuration</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Option</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
<th class="tableblock halign-left valign-top"><strong>Possible Values</strong></th>
<th class="tableblock halign-left valign-top"><strong>Default</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Header Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the HTTP header, e.g. <strong>Host</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any string.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allow request if header is missing</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines whether the request is
considered if a header is missing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allow request if no rules match</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines whether the request is
considered if no rule applies.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Header Rules</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Allow request if value matches</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines whether the request is
considered if the value applies.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true/false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Header Value Regex</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the header value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any regex.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_http_security_policy"><a class="anchor" href="#_http_security_policy"></a>HTTP Security Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-http-security"><a class="anchor" href="#policy-http-security"></a>Description</h3>
<div class="paragraph">
<p>Security-related HTTP headers can be set, such as HSTS, CSP and XSS protection.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_2"><a class="anchor" href="#_plugin_2"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "groupId": "io.apiman.plugins",
    "artifactId": "apiman-plugins-http-security-policy",
    "version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_6"><a class="anchor" href="#_configuration_6"></a>Configuration</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. HTTP security policy configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">frameOptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum [DENY, SAMEORIGIN, DISABLED]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Frame Options</strong>
Defines if, or how, a resource should be displayed in a frame, iframe or object.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DISABLED</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xssProtection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum [OFF, ON, BLOCK, DISABLED]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>XSS Protection</strong>
Enable or disable XSS filtering in the UA.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DISABLED</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentTypeOptions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>X-Content-Type-Options</strong>
Prevent MIME-sniffing to any type other than the declared Content-Type.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hsts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_hsts">hsts</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>HTTP Strict Transport Security</strong>
Configure HSTS.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentSecurityPolicy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_contentsecuritypolicy">contentSecurityPolicy</a></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Content Security Policy</strong>
CSP definition.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_hsts"><a class="anchor" href="#_hsts"></a>hsts</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. HTTP Strict Transport Security (hsts): Enforce transport security when using HTTP to mitigate a range of common web vulnerabilities.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>HSTS</strong>
Enable HTTP Strict Transport</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">includeSubdomains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include subdomains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Maximum age</strong>
Delta seconds user agents should cache HSTS status for</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">preload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Enable HSTS preloading</strong>
Flag to verify HSTS preload status.
Popular browsers contain a hard-coded (pinned) list of domains and certificates, which they always connect securely with.
This mitigates a wide range of identity and MIITM attacks, and is particularly useful for high-profile domains.
Users must submit a request for their domain to be included in the scheme.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_contentsecuritypolicy"><a class="anchor" href="#_contentsecuritypolicy"></a>contentSecurityPolicy</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. CSP (contentSecurityPolicy): A sophisticated mechanism to precisely define the types and sources of content that may be loaded, with violation reporting and the ability to restrict the availability and scope of many security-sensitive features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum [ENABLED, REPORT_ONLY, DISABLED]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>CSP Mode</strong>
Which content security policy mode to use.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DISABLED</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">csp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Content Security Policy</strong>
A valid CSP definition to apply</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty string</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_4"><a class="anchor" href="#_sample_configuration_4"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "contentSecurityPolicy" : {
      "mode" : "REPORT_ONLY",
      "csp" : "default-src none; script-src self; connect-src self; img-src self; style-src self;"
   },
   "frameOptions" : "SAMEORIGIN",
   "contentTypeOptions" : true,
   "hsts" : {
      "includeSubdomains" : true,
      "preload" : false,
      "enabled" : true,
      "maxAge" : 9001
   },
   "xssProtection" : "ON"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ignored_resources_policy"><a class="anchor" href="#_ignored_resources_policy"></a>Ignored Resources Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-ignored-resources"><a class="anchor" href="#policy-ignored-resources"></a>Description</h3>
<div class="paragraph">
<p>The ignored resources policy type enables you to shield some of an API&#8217;s resources from being accessed, without blocking access to all the API&#8217;s resources.
Requests made to access to API resources designated as “ignored” result in an HTTP 404 (“not found”) error code.
By defining ignored resource policies, apiman enables you to have fine-grained control over which of an API&#8217;s resources are accessible.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s say that you have an apiman managed API that provides information to remote staff.
The REST resources provided by this API are structured as follows:</p>
</div>
<div class="paragraph">
<p>/customers
/customers/{customer id}/orders
/customers/{customer id}/orders/bad_debts</p>
</div>
<div class="paragraph">
<p>By setting up multiple ignored resource policies, these policies can work together to give you more flexibility in how you govern access to to your API&#8217;s resources.
What you do is to define multiple plans, and in each plan, allow differing levels of access, based on the paths (expressed as regular expressions)defined, for resources to be ignored.
To illustrate, using the above examples:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 80%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">This Path</th>
<th class="tableblock halign-left valign-top">Results in these Resources Being Ignored</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(empty)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to all resources is allowed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/customers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Denies access to all customer information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/customers/.*/orders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Denies access to all customer order information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/customers/.*/orders/bad_debts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Denies access to all customer bad debt order information</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>What happens when the policy is applied to an API request is that the apiman Gateway matches the configured paths to the requested API resources.
If any of the exclusion paths match, the policy triggers a failure with an HTTP return code of 404.</p>
</div>
<div class="paragraph">
<p>The IP-related policy types are less fine-grained in that they allow or block access to all of an API&#8217;s resources based on the IP address of the client application. We&#8217;ll look at these policy types next.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_7"><a class="anchor" href="#_configuration_7"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration parameters for an Ignored Resources Policy are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>rules</strong> (array of objects) : The list of matching rules representing the resources to be ignored.</p>
<div class="ulist">
<ul>
<li>
<p><strong>verb</strong> (enum) : The HTTP verb to be controlled by the rule. Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>* (matches all verbs)</p>
</li>
<li>
<p>GET</p>
</li>
<li>
<p>POST</p>
</li>
<li>
<p>PUT</p>
</li>
<li>
<p>DELETE</p>
</li>
<li>
<p>OPTIONS</p>
</li>
<li>
<p>HEAD</p>
</li>
<li>
<p>TRACE</p>
</li>
<li>
<p>CONNECT</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>pathPattern</strong> (string regexp) : A regular expression used to match the REST resource being hidden.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_5"><a class="anchor" href="#_sample_configuration_5"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "rules" : [
    { "verb" : "GET",  "pathPattern" : "/customers" },
    { "verb" : "POST", "pathPattern" : "/customers/.*/orders" },
    { "verb" : "*",    "pathPattern" : "/customers/.*/orders/bad_debts"}
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ip_blacklist_policy"><a class="anchor" href="#_ip_blacklist_policy"></a>IP Blacklist Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-ip-blacklist"><a class="anchor" href="#policy-ip-blacklist"></a>Description</h3>
<div class="paragraph">
<p>As its name indicates, the IP blacklist policy type blocks access to an API&#8217;s resources based on the IP address of the client application.
The apiman Management UI form used to create an IP blacklist policy enables you to use wildcard characters in specifying the IP addresses to be blocked.
In addition, apiman gives you the option of specifying the return error code sent in the response to the client if a request is denied.
Note that an IP Blacklist policy in a plan overrides an IP Whitelist policy.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_8"><a class="anchor" href="#_configuration_8"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration parameters for an IP Blacklist Policy are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ipList</strong> (array) : The IP address(es), and/or ranges of addresses that will be blocked from accessing the API.</p>
</li>
<li>
<p><strong>responseCode</strong> (int) : The server response code. The possible values for the return code are:</p>
<div class="ulist">
<ul>
<li>
<p>500 - Server error</p>
</li>
<li>
<p>404 - Not found</p>
</li>
<li>
<p>403 - Authentication failure</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>httpHeader</strong> (string) [optional] : Tells apiman to use the IP address found in the given HTTP request header <strong>instead</strong> of the one associated with the incoming TCP socket.  Useful when going through a proxy, often the value of this is 'X-Forwarded-For'.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_6"><a class="anchor" href="#_sample_configuration_6"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "ipList" : ["192.168.7.*"],
  "responseCode" : 500,
  "httpHeader" : "X-Forwarded-For"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ip_whitelist_policy"><a class="anchor" href="#_ip_whitelist_policy"></a>IP Whitelist Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-ip-whitelist"><a class="anchor" href="#policy-ip-whitelist"></a>Description</h3>
<div class="paragraph">
<p>The IP Whitelist Policy Type is the counterpart to the IP Blacklist Policy type.
In the IP Whitelist policy, only inbound API requests from Client Apps, policies, or APIs that satisfy the policy are accepted.</p>
</div>
<div class="paragraph">
<p>The IP Blacklist and IP Whitelist policies are complementary, but different, approaches to limiting access to an API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The IP Blacklist policy type is exclusive in that you must specify the IP address ranges to be excluded from being able to access the API. Any addresses that you do not explicitly exclude from the policy are able to access the API.</p>
</li>
<li>
<p>The IP Whitelist policy type is inclusive in that you must specify the IP address ranges to be included to be able to access the API. Any addresses that you do not explicitly include are not able to access the API.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_9"><a class="anchor" href="#_configuration_9"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration parameters for an IP Whitelist Policy are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ipList</strong> (array) : The IP address(es), and/or ranges of addresses that will be allowed to access the API.</p>
</li>
<li>
<p><strong>responseCode</strong> (int) : The server response code. The possible values for the return code are:</p>
<div class="ulist">
<ul>
<li>
<p>500 - Server error</p>
</li>
<li>
<p>404 - Not found</p>
</li>
<li>
<p>403 - Authentication failure</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>httpHeader</strong> (string) [optional] : Tells apiman to use the IP address found in the given HTTP request header <strong>instead</strong> of the one associated with the incoming TCP socket.  Useful when going through a proxy, often the value of this is 'X-Forwarded-For'.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_7"><a class="anchor" href="#_sample_configuration_7"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "ipList" : ["192.168.3.*", "192.168.4.*"],
  "responseCode" : 403,
  "httpHeader" : "X-Forwarded-For"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jsonp_policy"><a class="anchor" href="#_jsonp_policy"></a>JSONP Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-jsonp"><a class="anchor" href="#policy-jsonp"></a>Description</h3>
<div class="paragraph">
<p>This policy turns a standard REST endpoint into a <a href="https://en.wikipedia.org/wiki/JSONP">JSONP</a> compatible endpoint.
For example, a REST endpoint may typically return the following JSON data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "foo" : "bar",
  "baz" : 17
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the JSONP policy is applied to this API, then the caller must provide a JSONP callback function name via the URL (for details on this, see the <strong>Configuration</strong> section below).
When this is done, the API might respond with this instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">callbackFunction({
  "foo" : "bar",
  "baz" : 17
})</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If the API client does not send the JSONP callback function name in the URL (via the configured query parameter name), this policy will do nothing.
This allows managed endpoints to support both standard REST <strong>and</strong> JSONP at the same time.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_3"><a class="anchor" href="#_plugin_3"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "groupId": "io.apiman.plugins",
    "artifactId": "apiman-plugins-jsonp-policy",
    "version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_10"><a class="anchor" href="#_configuration_10"></a>Configuration</h3>
<div class="paragraph">
<p>The JSONP policy has a single configuration property, which can be used to specify the name of the HTTP query parameter that the caller must use to pass the name of the JSONP callback function.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>callbackParamName</strong> (string) : Name of the HTTP query parameter that should contain the JSONP callback function name.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_8"><a class="anchor" href="#_sample_configuration_8"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "callbackParamName" : "callback"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the above configuration were to be used, the API client (caller) must send the JSONP callback function name in the URL of the request as a query parameter named <strong>callback</strong>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>GET /path/to/resource?callback=myCallbackFunction HTTP/1.1
Host: www.example.org
Accept: application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the response might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">myCallbackFunction({
  "property1" : "value1",
  "property2" : "value2"
})</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jwt_policy"><a class="anchor" href="#_jwt_policy"></a>JWT Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-jwt"><a class="anchor" href="#policy-jwt"></a>Description</h3>
<div class="paragraph">
<p>The JWT Policy helps you to validate JWT Tokens by providing a signing key and also via JSON Web Key Set (JWK(S)).
You can also require claims and strip them to forward them as header to the backend API.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_4"><a class="anchor" href="#_plugin_4"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "groupId": "io.apiman.plugins",
    "artifactId": "apiman-plugins-jwt-policy",
    "version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_11"><a class="anchor" href="#_configuration_11"></a>Configuration</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. JWT Policy configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requireJwt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Require JWT</strong>
Terminate request if no JWT is provided.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requireSigned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Require Signed JWT (JWS).</strong>
Require JWTs be cryptographically signed and verified (JWS).
It is strongly recommended to enable this option.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requireTransportSecurity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Require Transport Security</strong>
Any request used without transport security will be rejected. JWT requires transport security (e.g. TLS, SSL) to provide protection against a variety of attacks.
It is strongly advised this option be switched on.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stripTokens</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Strip tokens</strong>
Remove any Authorization header or token query parameter before forwarding traffic to the API</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signingKeyString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Signing Key or URL to a JWK(S)</strong>
To validate JWT. Must be Base-64 encoded or you specify a URL to a JWK(S)</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">kid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Key ID (kid) of JWK(S)</strong>
Only set this if you provided a JWK(S) URL. Specify here the kid of the JWK(S).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedClockSkew</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Integer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Maximum Clock Skew</strong>
Maximum allowed clock skew in seconds when validating exp (expiry) and nbf (not before) claims. Zero implies default behaviour.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requiredClaims</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#items">[items]</a>[]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Required Claimss</strong>
Set whether to forward roles to an authorization policy.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forwardAuthInfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_forwardauthinfo">forwardAuthInfo</a>[]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Forward Claim Information</strong>
Set auth information from the token into header(s).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_items"><a class="anchor" href="#_items"></a>items</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Require standard claims, custom claims and ID token fields (case sensitive).</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Claim</strong>
Fields that the token must contain.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Value</strong>
Value that must match with the value of the claim.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_forwardauthinfo"><a class="anchor" href="#_forwardauthinfo"></a>forwardAuthInfo</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Fields from the JWT can be set as headers and forwarded to the API. All <a href="https://openid.net/specs/openid-connect-basic-1_0.html#StandardClaims">standard claims</a>, custom claims and <a href="https://openid.net/specs/openid-connect-basic-1_0.html#IDToken">ID token fields</a> are available (case sensitive).
A special value of <strong>access_token</strong> will forward the entire encoded token. Nested claims can be accessed by using javascript dot syntax (e.g: <code>address.country</code>, <code>address.formatted</code>).
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Forward Keycloak token information</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Header</strong>
The header value to set (to paired field).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Field</strong>
The token field name.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_9"><a class="anchor" href="#_sample_configuration_9"></a>Sample Configuration</h3>
<div class="sect3">
<h4 id="_example_1_signing_key"><a class="anchor" href="#_example_1_signing_key"></a>Example 1 (Signing Key)</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "requireJWT": true,
  "requireSigned": false,
  "requireTransportSecurity": true,
  "stripTokens": true,
  "signingKeyString": "Y29uZ3JhdHVsYXRpb25zLCB5b3UgZm91bmQgdGhlIHNlY3JldCByb29tLiB5b3VyIHByaXplIGlzIGEgZnJlZSBkb3dubG9hZCBvZiBhcGltYW4h",
  "allowedClockSkew": 0,
  "requiredClaims": [
    {
      "claimName": "sub",
      "claimValue": "aride"
    }
  ],
  "forwardAuthInfo": [
    {
      "header": "X-Foo",
      "field": "sub"
    }
  ]
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_example_2_jwks"><a class="anchor" href="#_example_2_jwks"></a>Example 2 (JWK(S))</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "requireJWT": true,
  "requireSigned": true,
  "requireTransportSecurity": true,
  "stripTokens": false,
  "signingKeyString": "http://127.0.0.1:1080/jwks.json",
  "kid": null,
  "allowedClockSkew": 0,
  "requiredClaims": [
    {
      "claimName": "sub",
      "claimValue": "france frichot"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_keycloak_oauth_policy"><a class="anchor" href="#_keycloak_oauth_policy"></a>Keycloak OAuth Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-keycloak-oauth"><a class="anchor" href="#policy-keycloak-oauth"></a>Description</h3>
<div class="paragraph">
<p>A <a href="http://www.keycloak.org">Keycloak</a>-specific OAuth2 policy to regulate access to APIs.
This plugin enables a wide range of sophisticated auth facilities in combination with, for instance, Keycloak&#8217;s federation, brokering and user management capabilities.
An exploration of the basics can be found <a href="http://www.apiman.io/blog/gateway/security/oauth2/keycloak/authentication/authorization/1.2.x/2016/01/22/keycloak-oauth2-redux.html">in our blog</a>, but we encourage users to explore the <a href="http://keycloak.jboss.org/docs.html">project documentation</a>, as there is a tremendous depth and breadth of functionality, most of which work extremely well with apiman.</p>
</div>
<div class="paragraph">
<p>Keycloak&#8217;s token format and auth mechanism facilitate excellent performance characteristics, with users able to easily tune the setup to meet their security requirements.
In general, this is one of the best approaches for achieving security without greatly impacting performance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_5"><a class="anchor" href="#_plugin_5"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "groupId": "io.apiman.plugins",
    "artifactId": "apiman-plugins-keycloak-oauth-policy",
    "version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_12"><a class="anchor" href="#_configuration_12"></a>Configuration</h3>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Keycloak oauth2 policy configuration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requireOauth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Require auth token</strong>
Terminate request if no OAuth token is provided.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requireTransportSecurity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Require transport security</strong>
Any request used without transport security will be rejected.
OAuth2 requires transport security (e.g. TLS, SSL) to provide protection against replay attacks.
It is strongly advised for this option to be switched on</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blacklistUnsafeTokens</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Blacklist unsafe tokens</strong>
Any tokens used without transport security will be blackedlisted in all gateways to mitigate associated security risks.
Uses distributed data store to share blacklist</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stripTokens</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Strip tokens</strong>
Remove any Authorization header or token query parameter before forwarding traffic to the API</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">realm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Realm name</strong>
If you are using KeyCloak 1.2.0x or later this must be a full iss domain path (e.g. <code><a href="https://mykeycloak.local/auth/realms/apimanrealm" class="bare">https://mykeycloak.local/auth/realms/apimanrealm</a></code>); pre-1.2.0x simply use the realm name (e.g. <code>apimanrealm</code>).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">realmCertificateString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Keycloak Realm Certificate</strong>
To validate OAuth2 requests.
Must be a PEM-encoded X.509 certificate. This can be copied from the Keycloak console.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delegateKerberosTicket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Delegate Kerberos Ticket</strong>
Delegate any Kerberos Ticket embedded in the Keycloak token to the API (via the Authorization header).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forwardRoles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_forwardroles">forwardRoles</a>[]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Forward Keycloak roles</strong>
Set whether to forward roles to an authorization policy.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">forwardAuthInfo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_forwardauthinfo">forwardAuthInfo</a>[]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Forward auth information</strong>
Set auth information from the token into header(s).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_forwardroles"><a class="anchor" href="#_forwardroles"></a>forwardRoles</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Forward Keycloak roles to the Authorization policy. You should specify your required role(s) in the Authorization policy&#8217;s configuration.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Forward roles</strong>
Opt whether to forward any type of roles.
By default these will be <strong>realm roles</strong> unless the <code>applicationName</code> option is also provided.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applicationName (optional)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Application Name</strong>
Which application roles to forward.
Note that you cannot presently forward realm and application roles, only one or the other.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_forwardauthinfo_2"><a class="anchor" href="#_forwardauthinfo_2"></a>forwardAuthInfo</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Fields from the token can be set as headers and forwarded to the API. All <a href="https://openid.net/specs/openid-connect-basic-1_0.html#StandardClaims">standard claims</a>, custom claims and <a href="https://openid.net/specs/openid-connect-basic-1_0.html#IDToken">ID token fields</a> are available (case sensitive).
A special value of <strong>access_token</strong> will forward the entire encoded token. Nested claims can be accessed by using javascript dot syntax (e.g: <code>address.country</code>, <code>address.formatted</code>).
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Forward Keycloak token information</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Header</strong>
The header value to set (to paired field).</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">field</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Field</strong>
The token field name.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_10"><a class="anchor" href="#_sample_configuration_10"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "requireOauth": true,
  "requireTransportSecurity": true,
  "blacklistUnsafeTokens": false,
  "stripTokens": false,
  "realm": "apiman-is-cool",
  "realmCertificateString": "Y29uZ3JhdHVsYXRpb25zLCB5b3UgZm91bmQgdGhlIHNlY3JldCByb29tLiB5b3VyIHByaXplIGlzIGEgZnJlZSBkb3dubG9hZCBvZiBhcGltYW4h",
  "forwardRoles": {
    "active": true
  },
  "delegateKerberosTicket": false,
  "forwardAuthInfo": [
    {
      "headers": "X-COUNTRY",
      "field": "address.country"
    },
    {
      "headers": "X-USERNAME",
      "field": "preferred_username"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_log_policy"><a class="anchor" href="#_log_policy"></a>Log Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-log"><a class="anchor" href="#policy-log"></a>Description</h3>
<div class="paragraph">
<p>A policy that logs the headers to standard out.
Useful to analyse inbound HTTP traffic to the gateway when added as the first policy in the chain or to analyse outbound HTTP traffic from the gateway when added as the last policy in the chain.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_6"><a class="anchor" href="#_plugin_6"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "groupId": "io.apiman.plugins",
    "artifactId": "apiman-plugins-log-policy",
    "version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_13"><a class="anchor" href="#_configuration_13"></a>Configuration</h3>
<div class="paragraph">
<p>The Log Policy can be configured to output the request headers, the response headers, or both.
When configuring this policy via the apiman REST API, there is only property:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>direction</strong> (enum) : Which direction you wish to log, options are: 'request', 'response', 'both'</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_11"><a class="anchor" href="#_sample_configuration_11"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "direction" : "both"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_quota_policy"><a class="anchor" href="#_quota_policy"></a>Quota Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-quota"><a class="anchor" href="#policy-quota"></a>Description</h3>
<div class="paragraph">
<p>The Quota Policy type performs the same basic functionality as the Rate Limiting policy type, however, the intended use of this policy type is for less fine grained processing (e.g., 10,000 requests per month).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_14"><a class="anchor" href="#_configuration_14"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration parameters for a Quota Policy are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>limit</strong> (integer) : This is the number of requests that must be received before the policy will trigger.</p>
</li>
<li>
<p><strong>granularity</strong> (enum) : The apiman element for which the requests are counted. Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>User</p>
</li>
<li>
<p>Api</p>
</li>
<li>
<p>Client</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>period</strong> : The time period over which the policy is applied.  Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>Hour</p>
</li>
<li>
<p>Day</p>
</li>
<li>
<p>Month</p>
</li>
<li>
<p>Year</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>headerLimit</strong> (string) [optional] : HTTP response header that apiman will use to store the limit being applied.</p>
</li>
<li>
<p><strong>headerRemaining</strong> (string) [optional] : HTTP response header that apiman will use to store how many requests remain before the limit is reached.</p>
</li>
<li>
<p><strong>headerReset</strong> (string) [optional] : HTTP response header that apiman will use to store the number of seconds until the limit is reset.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_12"><a class="anchor" href="#_sample_configuration_12"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "limit" : 100000,
  "granularity" : "Client",
  "period" : "Month",
  "headerLimit" : "X-Quota-Limit",
  "headerRemaining" : "X-Quota-Limit-Remaining",
  "headerReset" : "X-Quota-Limit-Reset"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rate_limiting_policy"><a class="anchor" href="#_rate_limiting_policy"></a>Rate Limiting Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-rate-limiting"><a class="anchor" href="#policy-rate-limiting"></a>Description</h3>
<div class="paragraph">
<p>The Rate Limiting Policy type governs the number of times requests are made to an API within a specified time period.
The requests can be filtered by user, application, or API and can set the level of granularity for the time period to second, minute, hour, day, month, or year.
The intended use of this policy type is for fine grained processing (e.g., 10 requests per second).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_15"><a class="anchor" href="#_configuration_15"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration parameters for a Rate Limiting Policy are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>limit</strong> (integer) : This is the number of requests that must be received before the policy will trigger. Maximum value is 9007199254740991 (2^53 - 1).</p>
</li>
<li>
<p><strong>granularity</strong> (enum) : The apiman element for which the requests are counted. Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>User</p>
</li>
<li>
<p>Api</p>
</li>
<li>
<p>Client</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>period</strong> : The time period over which the policy is applied.  Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>Second</p>
</li>
<li>
<p>Minute</p>
</li>
<li>
<p>Hour</p>
</li>
<li>
<p>Day</p>
</li>
<li>
<p>Month</p>
</li>
<li>
<p>Year</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>headerLimit</strong> (string) [optional] : HTTP response header that apiman will use to store the limit being applied.</p>
</li>
<li>
<p><strong>headerRemaining</strong> (string) [optional] : HTTP response header that apiman will use to store how many requests remain before the limit is reached.</p>
</li>
<li>
<p><strong>headerReset</strong> (string) [optional] : HTTP response header that apiman will use to store the number of seconds until the limit is reset.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_13"><a class="anchor" href="#_sample_configuration_13"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "limit" : 100,
  "granularity" : "Api",
  "period" : "Minute",
  "headerLimit" : "X-Limit",
  "headerRemaining" : "X-Limit-Remaining",
  "headerReset" : "X-Limit-Reset"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_simple_header_policy"><a class="anchor" href="#_simple_header_policy"></a>Simple Header Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-simple-header"><a class="anchor" href="#policy-simple-header"></a>Description</h3>
<div class="paragraph">
<p>Set and remove headers on request, response or both.
The values can be literal strings, environment, system properties or request headers.
Headers can be removed by simple string equality or regular expression.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_7"><a class="anchor" href="#_plugin_7"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "groupId": "io.apiman.plugins",
    "artifactId": "apiman-plugins-simple-header-policy",
    "version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_16"><a class="anchor" href="#_configuration_16"></a>Configuration</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">addHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_addheaders">addHeaders</a>[]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Add and overwrite headers</strong>
Add headers to a request, response or both.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stripHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_stripheaders">stripHeaders</a>[]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Strip headers</strong>
Remove headers from a request, response or both when patterns match.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_addheaders"><a class="anchor" href="#_addheaders"></a>addHeaders</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Add headers</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headerName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Header Name</strong>
The name of the header to set.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">headerValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Header Value</strong>
The value of the header to set, or key into the environment or system properties, depending upon the value of <code>valueType</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">valueType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum [String, Env, "System Properties", Header]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Value Type</strong>
String:: Treat as a literal value.
Env:: Treat as a key into the environment <code>Env[headerValue]</code>, and set the returned value.
System Properties:: Treat as a key into the JVM&#8217;s System Properties, and set the returned value.
Header:: Treat as key into the http request headers, and set the returned value.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">applyTo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum [Request, Response, Both]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Where to apply rule</strong>
Request:: Request only.
Response:: Response only.
Both:: Both request and response.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overwrite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Overwrite</strong>
Overwrite any existing header with same name.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_stripheaders"><a class="anchor" href="#_stripheaders"></a>stripHeaders</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Strip headers</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 12.5%;">
<col style="width: 50%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stripType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum[Key, Value]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Strip when</strong>
Key:: <code>pattern</code> matches key.
Value:: <code>pattern</code> matches value.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">with</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enum[String, Regex]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>With matcher type</strong>
String:: Case-insensitive string equality.
Regex:: Case-insensitive regular expression.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Using pattern</strong>
String to match or compile into a regex, depending on the value of <code>with</code>.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Empty</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_14"><a class="anchor" href="#_sample_configuration_14"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "addHeaders": [
    {
      "headerName": "X-APIMAN-IS",
      "headerValue": "free-and-open-source",
      "valueType": "String",
      "applyTo": "Response",
      "overwrite": false
    },
    {
      "headerName": "X-LANG-FROM-ENV",
      "headerValue": "LANG",
      "valueType": "Env",
      "applyTo": "Both",
      "overwrite": true
    },
    {
      "headerName": "X-JAVA-VERSION-FROM-PROPS",
      "headerValue": "java.version",
      "valueType": "System Properties",
      "applyTo": "Request",
      "overwrite": false
    },
    {
      "headerName": "X-NEW-HTTP-HEADER",
      "headerValue": "X-OLD-HTTP-HEADER",
      "valueType": "Header",
      "applyTo": "Request",
      "overwrite": false
    }
  ],
  "stripHeaders": [
    {
      "stripType": "Key",
      "with": "String",
      "pattern": "Authorization"
    },
    {
      "stripType": "Key",
      "with": "Regex",
      "pattern": "^password=.*$"
    }
  ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_soap_authorization_policy"><a class="anchor" href="#_soap_authorization_policy"></a>SOAP Authorization Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-soap-authorization"><a class="anchor" href="#policy-soap-authorization"></a>Description</h3>
<div class="paragraph">
<p>This policy is nearly identical to our Authorization Policy, with the exception that it accepts a SOAPAction in the HTTP header.
Please note that this policy will only accept a single SOAPAction header, and will not extract the operation name from the SOAP body.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_8"><a class="anchor" href="#_plugin_8"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
	"groupId": "io.apiman.plugins",
	"artifactId": "apiman-plugins-soap-authorization-policy",
	"version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_17"><a class="anchor" href="#_configuration_17"></a>Configuration</h3>
<div class="paragraph">
<p>Just as with the Authorization policy, you can define any number of rules you&#8217;d like.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>rules</strong> (array) : A single rule that your policy will apply if each of the following properties match:</p>
<div class="ulist">
<ul>
<li>
<p><strong>action</strong> (string) : Defines the SOAPAction you&#8217;d like the policy to be applicable to.</p>
</li>
<li>
<p><strong>role</strong> (string) : The role the user must have if this pattern matches the request.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>multiMatch</strong> (boolean) : Should the request pass when any or all of the authorization rules pass?  Set to true if all rules must match, false if only one rule must match.</p>
</li>
<li>
<p><strong>requestUnmatched</strong> (boolean) : If the request does not match any of the authorization rules, should it pass or fail?  Set to true if you want the policy to <strong>pass</strong> when no rules are matched.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_15"><a class="anchor" href="#_sample_configuration_15"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "rules" : [
   	{
   		"action": "hello",
   		"role": "admin"
   	},
   	{
   		"action": "goodbye",
   		"role": "user"
   	}
   ],
   "multiMatch": true,
   "requestUnmatched": false
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_time_restricted_access_policy"><a class="anchor" href="#_time_restricted_access_policy"></a>Time Restricted Access Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-time-restricted-access"><a class="anchor" href="#policy-time-restricted-access"></a>Description</h3>
<div class="paragraph">
<p>This policy is used to only allow access to an API during certain times.
In fact, the policy can be configured to apply different time restrictions to different API resources (matched via regular expressions).
This allows you to control <strong>when</strong> client and users are allowed to access your API.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_18"><a class="anchor" href="#_configuration_18"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration parameters for a Time Restricted Access Policy are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>rules</strong> (array of objects) : The list of matching rules representing the resources being controlled and the time ranges they are allowed to be accessed.</p>
<div class="ulist">
<ul>
<li>
<p><strong>timeStart</strong> (time) : Indicates the time of day (UTC) to begin allowing access.</p>
</li>
<li>
<p><strong>timeEnd</strong> (time) : Indicates the time of day (UTC) to stop allowing access.</p>
</li>
<li>
<p><strong>dayStart</strong> (integer) : Indicates the day of week (1=Monday, 2=Tuesday, etc) to begin allowing access.</p>
</li>
<li>
<p><strong>dayEnd</strong> (integer) : Indicates the day of week (1=Monday, 2=Tuesday, etc) to stop allowing access.</p>
</li>
<li>
<p><strong>pathPattern</strong> (string regexp) : A regular expression used to match the request&#8217;s resource path/destination.  The time restriction will be applied only when the request&#8217;s resource matches this pattern.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If none of the configured rules matches the request resource path/destination, then no rules will be applied and the request will succeed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_16"><a class="anchor" href="#_sample_configuration_16"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "rules": [
        {
            "timeStart": "12:00:00",
            "timeEnd": "20:00:00",
            "dayStart": 1,
            "dayEnd": 5,
            "pathPattern": "/path/to/.*"
        },
        {
            "timeStart": "10:00:00.000Z",
            "timeEnd": "18:00:00.000Z",
            "dayStart": 1,
            "dayEnd": 7,
            "pathPattern": "/other/path/.*"
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transfer_quota_policy"><a class="anchor" href="#_transfer_quota_policy"></a>Transfer Quota Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-transfer-quota"><a class="anchor" href="#policy-transfer-quota"></a>Description</h3>
<div class="paragraph">
<p>In contrast to the other policy types, Transfer Quota tracks the number of bytes transferred (either uploaded or downloaded) rather than the total number of requests made.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_19"><a class="anchor" href="#_configuration_19"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration parameters for a Quota Policy are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>direction</strong> (enum) : Indicates whether uploads, downloads, or both directions should count against the limit.  Value values are:</p>
<div class="ulist">
<ul>
<li>
<p>upload</p>
</li>
<li>
<p>download</p>
</li>
<li>
<p>both</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>limit</strong> (integer) : This is the number of requests that must be received before the policy will trigger.</p>
</li>
<li>
<p><strong>granularity</strong> (enum) : The apiman element for which the transmitted bytes are counted. Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>User</p>
</li>
<li>
<p>Api</p>
</li>
<li>
<p>Client</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>period</strong> : The time period over which the policy is applied.  Valid values are:</p>
<div class="ulist">
<ul>
<li>
<p>Hour</p>
</li>
<li>
<p>Day</p>
</li>
<li>
<p>Month</p>
</li>
<li>
<p>Year</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>headerLimit</strong> (string) [optional] : HTTP response header that apiman will use to store the limit being applied.</p>
</li>
<li>
<p><strong>headerRemaining</strong> (string) [optional] : HTTP response header that apiman will use to store how many requests remain before the limit is reached.</p>
</li>
<li>
<p><strong>headerReset</strong> (string) [optional] : HTTP response header that apiman will use to store the number of seconds until the limit is reset.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_17"><a class="anchor" href="#_sample_configuration_17"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "direction" : "download",
  "limit" : 1024000,
  "granularity" : "Client",
  "period" : "Day",
  "headerLimit" : "X-XferQuota-Limit",
  "headerRemaining" : "X-XferQuota-Limit-Remaining",
  "headerReset" : "X-XferQuota-Limit-Reset"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transformation_policy"><a class="anchor" href="#_transformation_policy"></a>Transformation Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-transformation"><a class="anchor" href="#policy-transformation"></a>Description</h3>
<div class="paragraph">
<p>This policy converts an API format between JSON and XML.
If an API is implemented to return XML, but a client would prefer to receive JSON data, this policy can be used to automatically convert both the request and response bodies.
In this way, the client can work with JSON data even though the back-end API requires XML (and responds with XML).</p>
</div>
<div class="paragraph">
<p>Note that this policy is very generic, and does an automatic conversion between XML and JSON.
For more control over the specifics of the format conversion, a custom policy may be a better choice.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_9"><a class="anchor" href="#_plugin_9"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "groupId": "io.apiman.plugins",
    "artifactId": "apiman-plugins-transformation-policy",
    "version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_20"><a class="anchor" href="#_configuration_20"></a>Configuration</h3>
<div class="paragraph">
<p>The configuration of this policy consists of two properties which indicate:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the format required by the client</p>
</li>
<li>
<p>the format required by the back-end server</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>From these two properties, the policy can decide how (and if) to convert the data.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>clientFormat</strong> (enum) : The format required by the client, possible values are:  'XML', 'JSON'</p>
</li>
<li>
<p><strong>serverFormat</strong> (enum) : The format required by the server, possible values are:  'XML', 'JSON'</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_18"><a class="anchor" href="#_sample_configuration_18"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
   "clientFormat" : "JSON",
   "serverFormat" : "XML"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_url_rewriting_policy"><a class="anchor" href="#_url_rewriting_policy"></a>URL Rewriting Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-url-rewriting"><a class="anchor" href="#policy-url-rewriting"></a>Description</h3>
<div class="paragraph">
<p>This policy is used to re-write responses from the back-end API such that they will be modified by fixing up any incorrect URLs found with modified ones.
This is useful because apiman works through an API Gateway, and in some cases an API might return URLs to followup action or data endpoints.
In these cases the back-end API will likely be configured to return a URL pointing to the unmanaged API endpoint.
This policy can fix up those URL references so that they point to the managed API endpoint (the API Gateway endpoint) instead.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This is a built-in policy and therefore no plugins need to be installed prior to using it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_21"><a class="anchor" href="#_configuration_21"></a>Configuration</h3>
<div class="paragraph">
<p>This policy requires some basic configuration, including a regular expression used to match the URL, as well as a replacement value.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>fromRegex</strong> (string regex) : A regular expression used to identify a matching URL found in the response.</p>
</li>
<li>
<p><strong>toReplacement</strong> (string) : The replacement URL - regular expression groups identified in the <strong>fromRegex</strong> can be used.</p>
</li>
<li>
<p><strong>processBody</strong> (boolean) : Set to true if URLs should be replaced in the response body.</p>
</li>
<li>
<p><strong>processHeaders</strong> (boolean) : Set to true if URLs should be replaced in the response headers.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This policy <strong>cannot</strong> be used for any other replacements besides URLs - the policy is implemented specifically to find and replace valid URLs.
As a result, arbitrary regular expression matching will not work (the policy scans for URLs and then matches those URLs against the configured regex).
This is done for performance reasons.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_19"><a class="anchor" href="#_sample_configuration_19"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "fromRegex" : "https?://[^\/]*\/([.\/]*)",
    "toReplacement" : "https://apiman.example.com/$1",
    "processBody" : true,
    "processHeaders" : true

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_url_whitelist_policy"><a class="anchor" href="#_url_whitelist_policy"></a>URL Whitelist Policy</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="policy-url-whitelist"><a class="anchor" href="#policy-url-whitelist"></a>Description</h3>
<div class="paragraph">
<p>This policy allows users to explicitly allow only certain API subpaths to be accessed.
It&#8217;s particularly useful when only a small subset of resources from a back-end API should be exposed through the managed endpoint.</p>
</div>
</div>
<div class="sect2">
<h3 id="_plugin_10"><a class="anchor" href="#_plugin_10"></a>Plugin</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
	"groupId": "io.apiman.plugins",
	"artifactId": "apiman-plugins-url-whitelist-policy",
	"version": "TODO"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_22"><a class="anchor" href="#_configuration_22"></a>Configuration</h3>
<div class="paragraph">
<p>Configuration of the URL Whitelist Policy consists of a property to control the stripping of the managed endpoint prefix, and then a list of items representing the endpoint paths that are allowed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>removePathPrefix</strong> (boolean) : Set to true if you want the managed endpoint prefix to be stripped out before trying to match the request path to the whitelisted items (this is typically set to 'true').</p>
</li>
<li>
<p><strong>whitelist</strong> (array of objects) : A list of items, where each item represents an API sub-resource that should be allowed.</p>
<div class="ulist">
<ul>
<li>
<p><strong>regex</strong> (string) : Regular expression to match the API sub-resource path (e.g. /foo/[0-9]/bar)</p>
</li>
<li>
<p><strong>methodGet</strong> (boolean) : True if http GET should be allowed (default <strong>false</strong>).</p>
</li>
<li>
<p><strong>methodPost</strong> (boolean) :True if http POST should be allowed (default <strong>false</strong>).</p>
</li>
<li>
<p><strong>methodPut</strong> (boolean) : True if http PUT should be allowed (default <strong>false</strong>).</p>
</li>
<li>
<p><strong>methodPatch</strong> (boolean) : True if http PATCH should be allowed (default <strong>false</strong>).</p>
</li>
<li>
<p><strong>methodDelete</strong> (boolean) : True if http DELETE should be allowed (default <strong>false</strong>).</p>
</li>
<li>
<p><strong>methodHead</strong> (boolean) : True if http HEAD should be allowed (default <strong>false</strong>).</p>
</li>
<li>
<p><strong>methodOptions</strong> (boolean) : True if http OPTIONS should be allowed (default <strong>false</strong>).</p>
</li>
<li>
<p><strong>methodTrace</strong> (boolean) : True if http TRACE should be allowed (default <strong>false</strong>).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_sample_configuration_20"><a class="anchor" href="#_sample_configuration_20"></a>Sample Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "removePathPrefix" : true,
    "whitelist" : [
        {
            "regex" : "/admin/.*",
            "methodGet" : true,
            "methodPost" : true
        },
        {
            "regex" : "/users/.*",
            "methodGet" : true,
            "methodPost" : true,
            "methodPut" : true,
            "methodDelete" : true
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
